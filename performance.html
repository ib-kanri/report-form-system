<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>実績入力フォーム</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .header {
            background: #f5576c;
            color: white;
            padding: 24px;
            border-radius: 12px 12px 0 0;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
        }

        .header p {
            font-size: 14px;
            margin-top: 4px;
            opacity: 0.9;
        }

        .form-content {
            padding: 24px;
        }

        .summary-box {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 24px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .summary-item:last-child {
            margin-bottom: 0;
        }

        .section-header {
            font-size: 16px;
            font-weight: 600;
            color: #f5576c;
            margin: 24px 0 12px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #f0f0f0;
        }

        .form-group {
            margin-bottom: 16px;
        }

        label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #333;
            margin-bottom: 6px;
        }

        input[type="number"],
        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }

        input:focus {
            outline: none;
            border-color: #f5576c;
        }

        .amount-field::before {
            content: '¥';
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            font-size: 16px;
        }

        .amount-field {
            position: relative;
        }

        .amount-field input {
            padding-left: 28px;
        }

        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 24px;
        }

        .btn-back {
            padding: 16px;
            background: #e0e0e0;
            color: #666;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        .btn-submit {
            padding: 16px;
            background: #f5576c;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>実績入力フォーム</h1>
            <p id="kubunName"></p>
        </div>

        <div class="form-content">
            <div class="summary-box">
                <div class="summary-item">
                    <span>氏名:</span>
                    <strong id="summaryName"></strong>
                </div>
                <div class="summary-item">
                    <span>日付:</span>
                    <strong id="summaryDate"></strong>
                </div>
                <div class="summary-item">
                    <span>稼働先:</span>
                    <strong id="summaryWorkplace"></strong>
                </div>
            </div>

            <form id="performanceForm"></form>

            <div class="btn-group">
                <button type="button" class="btn-back" onclick="goBack()">戻る</button>
                <button type="button" class="btn-submit" onclick="submitForm()">送信</button>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbz8ek1mpv7jemHJgdyP5BUysHeLaigtkicDvx7cAhv5J9It8zgMGjpTH2xMmuTxkrSbHA/exec';

        // 稼働区分の定義
        const KUBUN_ITEMS = {
            'docomo稼働': [
                {section: '【docomo】'},
                {key: 'customer_count', label: '接客数', type: 'number'},
                {key: 'new_contract', label: '新規', type: 'number'},
                {key: 'mnp', label: 'MNP', type: 'number'},
                {key: 'model_change', label: '機種変更', type: 'number'},
                {key: 'fiber', label: '固定（光）', type: 'number'},
                {key: 'home_router', label: '固定（ホームルーター）', type: 'number'},
                {key: 'docomo_hikari', label: 'ドコモ光', type: 'number'},
                {key: 'home_5g', label: 'home 5G', type: 'number'},
                {key: 'dcard', label: 'd CARD', type: 'number'},
                {key: 'dcard_gold', label: 'd CARD GOLD', type: 'number'},
                {key: 'video', label: 'dTV/dアニメ', type: 'number'},
                {key: 'plus_one', label: 'プラスワン', type: 'amount'},
            ],
            'ショップ稼働｜au・UQ': [
                {section: '【au】'},
                {key: 'au_customer_count', label: '接客数', type: 'number'},
                {key: 'au_new_contract', label: '新規', type: 'number'},
                {key: 'au_mnp', label: 'MNP', type: 'number'},
                {key: 'au_model_change', label: '機種変更', type: 'number'},
                {key: 'au_fiber', label: 'auひかり', type: 'number'},
                {key: 'au_denki', label: 'auでんき', type: 'number'},
                {key: 'au_smartbank', label: 'auスマートバンク', type: 'number'},
                {key: 'au_pay_card', label: 'au PAY カード', type: 'number'},
                {key: 'au_plus_one', label: 'プラスワン', type: 'amount'},
                
                {section: '【UQ mobile】'},
                {key: 'uq_customer_count', label: '接客数', type: 'number'},
                {key: 'uq_new_contract', label: '新規', type: 'number'},
                {key: 'uq_mnp', label: 'MNP', type: 'number'},
                {key: 'uq_model_change', label: '機種変更', type: 'number'},
                {key: 'uq_selection', label: 'セレクション金額', type: 'amount'},
            ],
            '量販店稼働｜au・UQ': [
                {section: '【au】'},
                {key: 'au_customer_count', label: '接客数', type: 'number'},
                {key: 'au_new_contract', label: '新規', type: 'number'},
                {key: 'au_mnp', label: 'MNP', type: 'number'},
                {key: 'au_model_change', label: '機種変更', type: 'number'},
                {key: 'au_fiber', label: 'auひかり', type: 'number'},
                {key: 'au_denki', label: 'auでんき', type: 'number'},
                {key: 'au_smartbank', label: 'auスマートバンク', type: 'number'},
                {key: 'au_pay_card', label: 'au PAY カード', type: 'number'},
                {key: 'au_plus_one', label: 'プラスワン', type: 'amount'},
                
                {section: '【UQ mobile】'},
                {key: 'uq_customer_count', label: '接客数', type: 'number'},
                {key: 'uq_new_contract', label: '新規', type: 'number'},
                {key: 'uq_mnp', label: 'MNP', type: 'number'},
                {key: 'uq_model_change', label: '機種変更', type: 'number'},
                {key: 'uq_selection', label: 'セレクション金額', type: 'amount'},
            ],
            'ショップ稼働｜SB・YM': [
                {section: '【SoftBank】'},
                {key: 'sb_customer_count', label: '接客数', type: 'number'},
                {key: 'sb_new_contract', label: '新規', type: 'number'},
                {key: 'sb_mnp', label: 'MNP', type: 'number'},
                {key: 'sb_model_change', label: '機種変更', type: 'number'},
                {key: 'sb_fiber', label: 'SoftBank 光', type: 'number'},
                {key: 'sb_air', label: 'SoftBank Air', type: 'number'},
                {key: 'sb_denki', label: 'おうちでんき', type: 'number'},
                {key: 'sb_plus_one', label: 'プラスワン', type: 'amount'},
                
                {section: '【Y!mobile】'},
                {key: 'ym_customer_count', label: '接客数', type: 'number'},
                {key: 'ym_new_contract', label: '新規', type: 'number'},
                {key: 'ym_mnp', label: 'MNP', type: 'number'},
                {key: 'ym_model_change', label: '機種変更', type: 'number'},
            ],
            '量販店稼働｜SB・YM': [
                {section: '【SoftBank】'},
                {key: 'sb_customer_count', label: '接客数', type: 'number'},
                {key: 'sb_new_contract', label: '新規', type: 'number'},
                {key: 'sb_mnp', label: 'MNP', type: 'number'},
                {key: 'sb_model_change', label: '機種変更', type: 'number'},
                {key: 'sb_fiber', label: 'SoftBank 光', type: 'number'},
                {key: 'sb_air', label: 'SoftBank Air', type: 'number'},
                {key: 'sb_denki', label: 'おうちでんき', type: 'number'},
                {key: 'sb_plus_one', label: 'プラスワン', type: 'amount'},
                
                {section: '【Y!mobile】'},
                {key: 'ym_customer_count', label: '接客数', type: 'number'},
                {key: 'ym_new_contract', label: '新規', type: 'number'},
                {key: 'ym_mnp', label: 'MNP', type: 'number'},
                {key: 'ym_model_change', label: '機種変更', type: 'number'},
            ],
            'J:COM': [
                {key: 'customer_count', label: '接客数', type: 'number'},
                {key: 'sdu_net', label: 'SDU（戸建て）-ネット', type: 'number'},
                {key: 'sdu_tv', label: 'SDU（戸建て）-テレビ', type: 'number'},
                {key: 'sdu_phone', label: 'SDU（戸建て）-電話', type: 'number'},
                {key: 'mdu_net', label: 'MDU（集合住宅）-ネット', type: 'number'},
                {key: 'mdu_tv', label: 'MDU（集合住宅）-テレビ', type: 'number'},
                {key: 'mdu_phone', label: 'MDU（集合住宅）-電話', type: 'number'},
            ],
            '物販稼働': [
                {key: 'sales_amount', label: '売上金額', type: 'amount'},
                {key: 'sales_count', label: '販売個数', type: 'number'},
                {key: 'customer_count', label: '接客数', type: 'number'},
                {key: 'accessory', label: 'アクセサリー', type: 'number'},
            ],
            'FISTY稼働': [
                {key: 'new_free', label: '新規（無料ユーザー）', type: 'number'},
                {key: 'new_paid', label: '新規（有料ユーザー）', type: 'number'},
                {key: 'pv', label: 'PV数', type: 'number'},
                {key: 'negotiation', label: '商談数', type: 'number'},
                {key: 'content', label: 'コンテンツ制作', type: 'number'},
            ],
            'インターン・イベント稼働': [
                {key: 'approach', label: 'アプローチ数', type: 'number'},
                {key: 'seating', label: '着座数', type: 'number'},
                {key: 'contract', label: '成約数（トス含む）', type: 'number'},
            ],
        };

        // URL パラメータから稼働区分を取得
        const urlParams = new URLSearchParams(window.location.search);
        const kubun = urlParams.get('kubun');

        // 業務報告データを取得
        const workData = JSON.parse(sessionStorage.getItem('workData') || '{}');

        if (!kubun || !KUBUN_ITEMS[kubun] || !workData.name) {
            alert('エラー: 業務報告データが見つかりません');
            window.location.href = 'work.html';
        }

        // サマリー表示
        document.getElementById('kubunName').textContent = kubun;
        document.getElementById('summaryName').textContent = workData.name;
        document.getElementById('summaryDate').textContent = workData.date;
        document.getElementById('summaryWorkplace').textContent = workData.workplace;

        // フォーム生成
        const form = document.getElementById('performanceForm');
        KUBUN_ITEMS[kubun].forEach(item => {
            if (item.section) {
                // セクション見出し
                const header = document.createElement('div');
                header.className = 'section-header';
                header.textContent = item.section;
                form.appendChild(header);
            } else {
                // 入力フィールド
                const div = document.createElement('div');
                div.className = 'form-group';
                
                if (item.type === 'amount') {
                    div.innerHTML = `
                        <label>${item.label}</label>
                        <div class="amount-field">
                            <input type="text" id="${item.key}" value="0" inputmode="numeric">
                        </div>
                    `;
                } else {
                    div.innerHTML = `
                        <label>${item.label}</label>
                        <input type="number" id="${item.key}" value="0" min="0">
                    `;
                }
                form.appendChild(div);
            }
        });

        // 金額フィールドに半角数字制限を追加
        document.querySelectorAll('.amount-field input').forEach(input => {
            input.addEventListener('input', function(e) {
                let value = e.target.value;
                value = value.replace(/[０-９]/g, s => String.fromCharCode(s.charCodeAt(0) - 0xFEE0));
                value = value.replace(/[^\d]/g, '');
                e.target.value = value;
            });
        });

        function goBack() {
            if (confirm('入力内容が失われますが、戻りますか？')) {
                window.location.href = 'work.html';
            }
        }

        async function submitForm() {
            // 実績データを収集
            const performanceData = {};
            KUBUN_ITEMS[kubun].forEach(item => {
                if (item.key) {
                    const value = document.getElementById(item.key).value;
                    performanceData[item.key] = value || '0';
                }
            });

            // 業務報告データと実績データを結合
            const data = {
                type: '業務報告+実績',
                kubun: kubun,
                ...workData,
                performance: performanceData,
                timestamp: new Date().toLocaleString('ja-JP')
            };

            try {
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });

                alert('送信完了しました');
                sessionStorage.removeItem('workData');
                window.location.href = 'index.html';
            } catch (error) {
                alert('送信エラー: ' + error.message);
            }
        }
    </script>
</body>
</html>
