<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>実績入力フォーム</title>
    <style>
        :root {
            --primary: #1a73e8;
            --primary-dark: #1557b0;
            --success: #34a853;
            --error: #ea4335;
            --gray-50: #f8f9fa;
            --gray-100: #f1f3f4;
            --gray-300: #dadce0;
            --gray-700: #5f6368;
            --gray-900: #202124;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-size: 16px;
            line-height: 1.6;
            color: var(--gray-900);
            background: var(--gray-50);
        }

        .header {
            background: var(--primary);
            color: white;
            padding: 16px;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 18px;
            font-weight: 500;
        }

        .container {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            padding: 16px;
            background: white;
        }

        .form-group {
            margin-bottom: 24px;
        }

        label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-900);
            margin-bottom: 8px;
        }

        .required {
            color: var(--error);
        }

        input, select, textarea {
            width: 100%;
            height: 48px;
            padding: 12px 16px;
            font-size: 16px;
            border: 1px solid var(--gray-300);
            border-radius: 4px;
            background: white;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);
        }

        input[readonly] {
            background: var(--gray-50);
            color: var(--gray-700);
        }

        textarea {
            min-height: 120px;
            height: auto;
            resize: vertical;
        }

        .section-header {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary);
            padding: 12px 0 8px 0;
            margin-top: 16px;
            border-bottom: 2px solid var(--primary);
        }

        .section-header:first-of-type {
            margin-top: 0;
        }

        .amount-input-wrapper {
            position: relative;
        }

        .amount-input-wrapper::before {
            content: '¥';
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-700);
            font-size: 16px;
            pointer-events: none;
        }

        .amount-input-wrapper input {
            padding-left: 36px;
        }

        .btn-submit {
            width: 100%;
            height: 48px;
            font-size: 16px;
            font-weight: 500;
            color: white;
            background: var(--primary);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 24px;
        }

        .btn-submit:hover {
            background: var(--primary-dark);
        }

        .btn-submit:disabled {
            background: var(--gray-300);
            cursor: not-allowed;
        }

        .message {
            padding: 16px;
            border-radius: 4px;
            margin-bottom: 16px;
            display: none;
        }

        .message.success {
            background: rgba(52, 168, 83, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .message.error {
            background: rgba(234, 67, 53, 0.1);
            border: 1px solid var(--error);
            color: var(--error);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--gray-700);
        }

        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }

            .form-group {
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>実績入力</h1>
    </div>

    <div class="container">
        <div id="message" class="message"></div>

        <form id="performanceForm">
            <!-- 基本情報 -->
            <div class="form-group">
                <label for="reportDate">報告日付 <span class="required">*</span></label>
                <input type="date" id="reportDate" name="reportDate" required>
            </div>

            <div class="form-group">
                <label for="employeeId">社員ID</label>
                <input type="text" id="employeeId" name="employeeId" readonly>
            </div>

            <div class="form-group">
                <label for="employeeName">氏名</label>
                <input type="text" id="employeeName" name="employeeName" readonly>
            </div>

            <div class="form-group">
                <label for="kubun">稼働区分 <span class="required">*</span></label>
                <select id="kubun" name="kubun" required>
                    <option value="">選択してください</option>
                    <option value="docomo稼働">docomo稼働</option>
                    <option value="ショップ稼働｜au・UQ">ショップ稼働｜au・UQ</option>
                    <option value="量販店稼働｜au・UQ">量販店稼働｜au・UQ</option>
                    <option value="ショップ稼働｜SB・YM">ショップ稼働｜SB・YM</option>
                    <option value="量販店稼働｜SB・YM">量販店稼働｜SB・YM</option>
                    <option value="J:COM稼働">J:COM稼働</option>
                    <option value="物販稼働">物販稼働</option>
                    <option value="FISTY稼働">FISTY稼働</option>
                    <option value="本社稼働">本社稼働</option>
                    <option value="ラウンダー稼働">ラウンダー稼働</option>
                    <option value="インターン・イベント稼働">インターン・イベント稼働</option>
                </select>
            </div>

            <!-- 動的フォームエリア -->
            <div id="dynamicFormArea"></div>

            <button type="submit" class="btn-submit" id="submitBtn">送信</button>
        </form>
    </div>

    <script>
        // kubun_items.jsの内容を埋め込み
        const KUBUN_ITEMS = {
  "docomo稼働": [
    {
      "section": "モバイル"
    },
    {
      "key": "新規契約",
      "label": "新規契約",
      "type": "number"
    },
    {
      "key": "MNP",
      "label": "MNP",
      "type": "number"
    },
    {
      "key": "機種変更",
      "label": "機種変更",
      "type": "number"
    },
    {
      "key": "マイグレ",
      "label": "マイグレ",
      "type": "number"
    },
    {
      "section": "固定回線"
    },
    {
      "key": "docomo光 1ギガ",
      "label": "docomo光 1ギガ",
      "type": "number"
    },
    {
      "key": "docomo光 10ギガ",
      "label": "docomo光 10ギガ",
      "type": "number"
    },
    {
      "key": "home5G",
      "label": "home5G",
      "type": "number"
    },
    {
      "key": "homeでんわ",
      "label": "homeでんわ",
      "type": "number"
    },
    {
      "section": "その他"
    },
    {
      "key": "タブレット",
      "label": "タブレット",
      "type": "number"
    },
    {
      "key": "でんき",
      "label": "でんき",
      "type": "number"
    },
    {
      "key": "スカパー",
      "label": "スカパー",
      "type": "number"
    },
    {
      "key": "H4D",
      "label": "H4D",
      "type": "number"
    },
    {
      "key": "Disney+",
      "label": "Disney+",
      "type": "number"
    },
    {
      "key": "dカード",
      "label": "dカード",
      "type": "number"
    },
    {
      "key": "dカード（ゴールド）",
      "label": "dカード（ゴールド）",
      "type": "number"
    },
    {
      "key": "dカード（プラチナ）",
      "label": "dカード（プラチナ）",
      "type": "number"
    }
  ],
  "ショップ稼働｜au・UQ": [
    {
      "section": "au"
    },
    {
      "key": "新規契約",
      "label": "新規契約",
      "type": "number"
    },
    {
      "key": "MNP",
      "label": "MNP",
      "type": "number"
    },
    {
      "key": "機種変更",
      "label": "機種変更",
      "type": "number"
    },
    {
      "key": "機種変更（同一機種）",
      "label": "機種変更（同一機種）",
      "type": "number"
    },
    {
      "section": "UQ"
    },
    {
      "key": "UQ新規",
      "label": "UQ新規",
      "type": "number"
    },
    {
      "key": "UQ MNP",
      "label": "UQ MNP",
      "type": "number"
    },
    {
      "key": "UQ機変",
      "label": "UQ機変",
      "type": "number"
    },
    {
      "section": "固定回線"
    },
    {
      "key": "auひかり",
      "label": "auひかり",
      "type": "number"
    },
    {
      "key": "JCOM",
      "label": "JCOM",
      "type": "number"
    },
    {
      "key": "ホームルーター5G",
      "label": "ホームルーター5G",
      "type": "number"
    },
    {
      "section": "その他"
    },
    {
      "key": "タブレット",
      "label": "タブレット",
      "type": "number"
    },
    {
      "key": "でんき",
      "label": "でんき",
      "type": "number"
    },
    {
      "key": "スマートバリュー",
      "label": "スマートバリュー",
      "type": "number"
    },
    {
      "key": "auスマートパス",
      "label": "auスマートパス",
      "type": "number"
    },
    {
      "key": "auスマートパスプレミアム",
      "label": "auスマートパスプレミアム",
      "type": "number"
    },
    {
      "key": "故障紛失サポート",
      "label": "故障紛失サポート",
      "type": "number"
    },
    {
      "key": "au PAY カード",
      "label": "au PAY カード",
      "type": "number"
    },
    {
      "key": "au PAY ゴールドカード",
      "label": "au PAY ゴールドカード",
      "type": "number"
    },
    {
      "key": "HOME",
      "label": "HOME",
      "type": "number"
    }
  ],
  "量販店稼働｜au・UQ": [
    {
      "section": "au"
    },
    {
      "key": "新規契約",
      "label": "新規契約",
      "type": "number"
    },
    {
      "key": "MNP",
      "label": "MNP",
      "type": "number"
    },
    {
      "key": "機種変更",
      "label": "機種変更",
      "type": "number"
    },
    {
      "key": "機種変更（同一機種）",
      "label": "機種変更（同一機種）",
      "type": "number"
    },
    {
      "section": "UQ"
    },
    {
      "key": "UQ新規",
      "label": "UQ新規",
      "type": "number"
    },
    {
      "key": "UQ MNP",
      "label": "UQ MNP",
      "type": "number"
    },
    {
      "key": "UQ機変",
      "label": "UQ機変",
      "type": "number"
    },
    {
      "section": "固定回線"
    },
    {
      "key": "auひかり",
      "label": "auひかり",
      "type": "number"
    },
    {
      "key": "JCOM",
      "label": "JCOM",
      "type": "number"
    },
    {
      "key": "ホームルーター5G",
      "label": "ホームルーター5G",
      "type": "number"
    },
    {
      "section": "その他"
    },
    {
      "key": "タブレット",
      "label": "タブレット",
      "type": "number"
    },
    {
      "key": "でんき",
      "label": "でんき",
      "type": "number"
    }
  ],
  "ショップ稼働｜SB・YM": [
    {
      "section": "SoftBank"
    },
    {
      "key": "新規契約",
      "label": "新規契約",
      "type": "number"
    },
    {
      "key": "MNP",
      "label": "MNP",
      "type": "number"
    },
    {
      "key": "機種変更",
      "label": "機種変更",
      "type": "number"
    },
    {
      "section": "Y!mobile"
    },
    {
      "key": "YM新規",
      "label": "YM新規",
      "type": "number"
    },
    {
      "key": "YM MNP",
      "label": "YM MNP",
      "type": "number"
    },
    {
      "key": "YM機変",
      "label": "YM機変",
      "type": "number"
    },
    {
      "section": "固定回線"
    },
    {
      "key": "SoftBank光",
      "label": "SoftBank光",
      "type": "number"
    },
    {
      "key": "SoftBank Air",
      "label": "SoftBank Air",
      "type": "number"
    },
    {
      "section": "その他"
    },
    {
      "key": "タブレット",
      "label": "タブレット",
      "type": "number"
    },
    {
      "key": "でんき",
      "label": "でんき",
      "type": "number"
    },
    {
      "key": "おうち割",
      "label": "おうち割",
      "type": "number"
    },
    {
      "key": "PayPayカード",
      "label": "PayPayカード",
      "type": "number"
    },
    {
      "key": "PayPayカード（ゴールド）",
      "label": "PayPayカード（ゴールド）",
      "type": "number"
    },
    {
      "key": "あんしん保証パック",
      "label": "あんしん保証パック",
      "type": "number"
    }
  ],
  "量販店稼働｜SB・YM": [
    {
      "section": "SoftBank"
    },
    {
      "key": "新規契約",
      "label": "新規契約",
      "type": "number"
    },
    {
      "key": "MNP",
      "label": "MNP",
      "type": "number"
    },
    {
      "key": "機種変更",
      "label": "機種変更",
      "type": "number"
    },
    {
      "section": "Y!mobile"
    },
    {
      "key": "YM新規",
      "label": "YM新規",
      "type": "number"
    },
    {
      "key": "YM MNP",
      "label": "YM MNP",
      "type": "number"
    },
    {
      "key": "YM機変",
      "label": "YM機変",
      "type": "number"
    },
    {
      "section": "固定回線"
    },
    {
      "key": "SoftBank光",
      "label": "SoftBank光",
      "type": "number"
    },
    {
      "key": "SoftBank Air",
      "label": "SoftBank Air",
      "type": "number"
    },
    {
      "section": "その他"
    },
    {
      "key": "タブレット",
      "label": "タブレット",
      "type": "number"
    },
    {
      "key": "でんき",
      "label": "でんき",
      "type": "number"
    }
  ],
  "J:COM稼働": [
    {
      "section": "J:COM NET"
    },
    {
      "key": "新規開通",
      "label": "新規開通",
      "type": "number"
    },
    {
      "key": "グレードアップ",
      "label": "グレードアップ",
      "type": "number"
    },
    {
      "section": "J:COM MOBILE"
    },
    {
      "key": "新規契約",
      "label": "新規契約",
      "type": "number"
    },
    {
      "key": "MNP",
      "label": "MNP",
      "type": "number"
    },
    {
      "key": "機種変更",
      "label": "機種変更",
      "type": "number"
    },
    {
      "section": "その他"
    },
    {
      "key": "J:COM TV",
      "label": "J:COM TV",
      "type": "number"
    },
    {
      "key": "J:COM PHONE",
      "label": "J:COM PHONE",
      "type": "number"
    },
    {
      "key": "J:COM でんき",
      "label": "J:COM でんき",
      "type": "number"
    },
    {
      "key": "J:COM ガス",
      "label": "J:COM ガス",
      "type": "number"
    }
  ],
  "物販稼働": [
    {
      "section": "アクセサリー・物販"
    },
    {
      "key": "売上金額",
      "label": "売上金額",
      "type": "amount"
    },
    {
      "key": "販売個数",
      "label": "販売個数",
      "type": "number"
    },
    {
      "key": "備考",
      "label": "備考（商品名など）",
      "type": "text"
    }
  ],
  "FISTY稼働": [
    {
      "section": "FISTY実績"
    },
    {
      "key": "新規会員",
      "label": "新規会員",
      "type": "number"
    },
    {
      "key": "体験予約",
      "label": "体験予約",
      "type": "number"
    },
    {
      "key": "体験来店",
      "label": "体験来店",
      "type": "number"
    },
    {
      "key": "入会",
      "label": "入会",
      "type": "number"
    },
    {
      "key": "備考",
      "label": "備考",
      "type": "text"
    }
  ],
  "本社稼働": [
    {
      "section": "本社業務"
    },
    {
      "key": "業務内容",
      "label": "業務内容",
      "type": "text"
    },
    {
      "key": "成果・進捗",
      "label": "成果・進捗",
      "type": "text"
    },
    {
      "key": "課題・改善点",
      "label": "課題・改善点",
      "type": "text"
    }
  ],
  "ラウンダー稼働": [
    {
      "section": "ラウンダー業務"
    },
    {
      "key": "訪問店舗数",
      "label": "訪問店舗数",
      "type": "number"
    },
    {
      "key": "訪問店舗名",
      "label": "訪問店舗名",
      "type": "text"
    },
    {
      "key": "実施内容",
      "label": "実施内容",
      "type": "text"
    },
    {
      "key": "店舗課題・改善提案",
      "label": "店舗課題・改善提案",
      "type": "text"
    }
  ],
  "インターン・イベント稼働": [
    {
      "section": "インターン・イベント"
    },
    {
      "key": "イベント名",
      "label": "イベント名",
      "type": "text"
    },
    {
      "key": "実施内容",
      "label": "実施内容",
      "type": "text"
    },
    {
      "key": "成果",
      "label": "成果",
      "type": "text"
    }
  ]
};

        // セッションストレージから従業員情報を取得
        function loadEmployeeInfo() {
            const employeeId = sessionStorage.getItem('employeeId');
            const employeeName = sessionStorage.getItem('employeeName');
            const defaultKubun = sessionStorage.getItem('defaultKubun');

            if (!employeeId || !employeeName) {
                alert('ログイン情報が見つかりません。ログインページに戻ります。');
                window.location.href = 'index.html';
                return;
            }

            document.getElementById('employeeId').value = employeeId;
            document.getElementById('employeeName').value = employeeName;

            // デフォルト稼働区分を設定
            if (defaultKubun) {
                document.getElementById('kubun').value = defaultKubun;
                renderDynamicForm(defaultKubun);
            }

            // 今日の日付を設定
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('reportDate').value = today;
        }

        // 動的フォームを生成
        function renderDynamicForm(kubun) {
            const dynamicArea = document.getElementById('dynamicFormArea');
            dynamicArea.innerHTML = '';

            const items = KUBUN_ITEMS[kubun];
            if (!items) return;

            items.forEach(item => {
                if (item.section) {
                    // セクションヘッダー
                    const sectionHeader = document.createElement('div');
                    sectionHeader.className = 'section-header';
                    sectionHeader.textContent = item.section;
                    dynamicArea.appendChild(sectionHeader);
                } else {
                    // フィールド生成
                    const formGroup = document.createElement('div');
                    formGroup.className = 'form-group';

                    const label = document.createElement('label');
                    label.textContent = item.label;
                    label.setAttribute('for', item.key);
                    formGroup.appendChild(label);

                    if (item.type === 'number') {
                        const input = document.createElement('input');
                        input.type = 'number';
                        input.id = item.key;
                        input.name = item.key;
                        input.min = '0';
                        input.step = '1';
                        input.value = '0';
                        formGroup.appendChild(input);
                    } else if (item.type === 'amount') {
                        const wrapper = document.createElement('div');
                        wrapper.className = 'amount-input-wrapper';
                        const input = document.createElement('input');
                        input.type = 'number';
                        input.id = item.key;
                        input.name = item.key;
                        input.min = '0';
                        input.step = '1';
                        input.value = '0';
                        wrapper.appendChild(input);
                        formGroup.appendChild(wrapper);
                    } else if (item.type === 'text') {
                        const textarea = document.createElement('textarea');
                        textarea.id = item.key;
                        textarea.name = item.key;
                        textarea.rows = '4';
                        formGroup.appendChild(textarea);
                    }

                    dynamicArea.appendChild(formGroup);
                }
            });
        }

        // 稼働区分変更時
        document.getElementById('kubun').addEventListener('change', function() {
            renderDynamicForm(this.value);
        });

        // フォーム送信処理
        document.getElementById('performanceForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const submitBtn = document.getElementById('submitBtn');
            const messageDiv = document.getElementById('message');

            submitBtn.disabled = true;
            submitBtn.textContent = '送信中...';

            try {
                const formData = new FormData(this);
                const data = {
                    reportDate: formData.get('reportDate'),
                    employeeId: formData.get('employeeId'),
                    employeeName: formData.get('employeeName'),
                    kubun: formData.get('kubun'),
                    items: {}
                };

                // 動的フィールドの値を取得
                const kubun = formData.get('kubun');
                const items = KUBUN_ITEMS[kubun];
                if (items) {
                    items.forEach(item => {
                        if (!item.section && item.key) {
                            const value = formData.get(item.key);
                            if (value !== null && value !== '') {
                                data.items[item.key] = value;
                            }
                        }
                    });
                }

                // Google Apps Scriptに送信
                const response = await fetch('https://script.google.com/macros/s/AKfycbx8XJGE_QgHdN7LTqm3MJUvqw6X7lS3b93WTygsOg5lni-WEOLoqrX13_moNyRYzWcf5w/exec', {
                    method: 'POST',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'savePerformance',
                        data: data
                    })
                });

                const result = await response.json();

                if (result.success) {
                    messageDiv.className = 'message success';
                    messageDiv.textContent = '実績を保存しました';
                    messageDiv.style.display = 'block';

                    // フォームをリセット
                    setTimeout(() => {
                        window.location.href = 'menu.html';
                    }, 1500);
                } else {
                    throw new Error(result.message || '保存に失敗しました');
                }
            } catch (error) {
                messageDiv.className = 'message error';
                messageDiv.textContent = 'エラー: ' + error.message;
                messageDiv.style.display = 'block';
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '送信';
            }
        });

        // ページ読み込み時
        document.addEventListener('DOMContentLoaded', loadEmployeeInfo);
    </script>
</body>
</html>
